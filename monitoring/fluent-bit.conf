# =============================================================================
# NIS2 Shield - Fluent Bit Configuration
# =============================================================================
# This config works with both Django and Spring Boot applications.
# Both frameworks produce identical JSON log formats, ensuring seamless
# interoperability with your SIEM infrastructure.
# =============================================================================

[SERVICE]
    # Flush interval (seconds)
    Flush        1
    # Fluent Bit daemon log level
    Log_Level    info
    Parsers_File parsers.conf

# === INPUT: Application Logs (Django or Spring Boot) ===
# Both frameworks write to the same path with identical JSON format
[INPUT]
    Name              tail
    Path              /var/log/shared/app.json
    Tag               nis2.app
    Parser            json
    DB                /var/log/flb_state.db
    Mem_Buf_Limit     5MB
    Skip_Long_Lines   On
    Refresh_Interval  10

# === INPUT: Spring Boot Actuator Logs (Optional) ===
# Uncomment if your Spring app writes actuator logs separately
# [INPUT]
#     Name              tail
#     Path              /var/log/shared/actuator.json
#     Tag               nis2.actuator
#     Parser            json
#     DB                /var/log/flb_actuator.db
#     Mem_Buf_Limit     2MB

[FILTER]
    Name              record_modifier
    Match             *
    Record            hostname ${HOSTNAME}
    Record            service nis2-app
    Record            environment ${ENVIRONMENT}

# === OUTPUT: Console (Development) ===
[OUTPUT]
    Name              stdout
    Match             *
    Format            json_lines

# === OUTPUT: Elasticsearch (Uncomment for production) ===
# [OUTPUT]
#     Name              es
#     Match             *
#     Host              ${ELASTICSEARCH_HOST}
#     Port              9200
#     Index             nis2-logs
#     Type              _doc
#     Logstash_Format   On
#     Logstash_Prefix   nis2
#     Include_Tag_Key   On
#     Tag_Key           _flb_tag

# === OUTPUT: HTTP/SIEM (Uncomment for Intrusa, Splunk HEC, etc.) ===
# [OUTPUT]
#     Name              http
#     Match             *
#     Host              ${SIEM_HOST}
#     Port              443
#     URI               /api/v1/ingest
#     Format            json
#     tls               On
#     tls.verify        On
#     Header            Authorization Bearer ${SIEM_API_TOKEN}